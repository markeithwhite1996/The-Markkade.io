<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Markkâ€™d for Fortune</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1d1f27;
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
      user-select: none;
    }
    h1 {
      background: linear-gradient(135deg, #d4af37, #8b6914);
      padding: 20px;
      font-size: 2em;
      margin: 0;
    }
    #status {
      font-size: 1.3em;
      margin: 10px 0;
      color: #ffd700;
      min-height: 1.6em;
    }
    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      position: relative;
    }
    #your-numbers,
    #scratch-grid {
      transition: opacity 0.3s ease;
    }
    .disabled-grid {
      opacity: 0.3;
      pointer-events: none;
    }
    #your-numbers {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      justify-content: center;
      max-width: 270px;
      margin: 0 auto;
    }
    .card-section {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      justify-items: center;
      width: 100%;
      max-width: 500px;
    }
    .scratch-slot {
      position: relative;
      width: 80px;
      height: 60px;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid gold;
    }
    .scratch-content {
      position: absolute;
      width: 100%;
      height: 100%;
      background: #fff;
      color: #000;
      font-size: 1.5em;
      font-weight: bold;
      line-height: 60px;
      text-align: center;
      z-index: 1;
      user-select: none;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    #result {
      font-size: 1.3em;
      color: #ffd700;
      margin: 10px 0;
      min-height: 1.5em;
      min-width: 280px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.1em;
      background: linear-gradient(145deg, #d4af37, #b8860b);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover:not(:disabled) {
      background: linear-gradient(145deg, #f0c93b, #a6760f);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #paytable {
      background: #2c2f38;
      border: 2px solid #d4af37;
      margin: 20px auto;
      padding: 15px 20px;
      max-width: 400px;
      border-radius: 10px;
      color: #fff;
      text-align: left;
    }
    #paytable h2 {
      margin-bottom: 10px;
      font-size: 1.3em;
      color: #ffd700;
      text-align: center;
    }
    #paytable ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 1em;
    }
    #paytable li {
      margin: 6px 0;
      line-height: 1.3em;
    }
    #popup {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(212, 175, 55, 0.9);
      color: #1d1f27;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 1.4em;
      font-weight: bold;
      z-index: 9999;
      display: none;
      box-shadow: 0 0 15px gold;
      user-select: none;
    }
    #paytable-balance {
      text-align: center;
      font-size: 1.3em;
      margin-bottom: 10px;
      color: #ffd700;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ° Markkâ€™d for Fortune ğŸ°</h1>
  <div id="popup"></div>
  <div id="status">Balance: $0 | Tickets: 0</div>
  <div id="game">
    <div>
      <h2>ğŸ¯ Your Winning Numbers</h2>
      <div class="card-section" id="your-numbers"></div>
    </div>
    <div>
      <h2>ğŸŸï¸ Scratch Off</h2>
      <div class="card-section" id="scratch-grid"></div>
    </div>
  </div>
  <div id="result"></div>
  <button id="buy-ticket-btn">Buy Ticket ($5)</button>
  <button id="free-ticket-btn">ğŸŸï¸ Free Ticket</button>
  <br />
<a href="../../index.html" style="color: #ffd700; user-select: none;">ğŸ  Back to Arcade</a>
  <div id="paytable">
    <div id="paytable-balance">Balance: $0 | Tickets: 0</div>
    <h2>Pay Table</h2>
    <ul>
      <li>ğŸ¯ Match 1 Number = $1 (Paid games only)</li>
      <li>ğŸ¯ Match 2 Numbers = $2 (Paid games only)</li>
      <li>ğŸ¯ Match 3 Numbers = $3 (Paid games only)</li>
      <li>ğŸ’° 2x Bonus = Double Winnings (Paid games only)</li>
      <li>ğŸ’° 5x Bonus = 5x Winnings (Paid games only)</li>
      <li>ğŸ’° 10x Bonus = 10x Winnings (Paid games only)</li>
      <li>ğŸ’° 100x Bonus = 100x Winnings (Paid games only)</li>
      <li>ğŸŸï¸ Free Ticket = Free Ticket Win (Both games)</li>
    </ul>
  </div>

<script>
let balance = parseFloat(sessionStorage.getItem('playerCash')) || 100;
let tickets = parseInt(sessionStorage.getItem('currentTickets')) || 0;

let freeTicketActive = false;
let gameStarted = false;
let playerNumbers = [];
let scratchNumbers = [];
let matches = 0;
let bonus = null;
let countdownInterval = null;

const bonuses = ["2x", "5x", "10x", "100x", "Free Ticket"];

const statusEl = document.getElementById('status');
const balanceDisplay = document.getElementById('paytable-balance');
const resultDiv = document.getElementById('result');
const popup = document.getElementById('popup');
const buyBtn = document.getElementById('buy-ticket-btn');
const freeBtn = document.getElementById('free-ticket-btn');

function updateDisplay(countdownSeconds = null) {
  sessionStorage.setItem('playerCash', balance);
  sessionStorage.setItem('currentTickets', tickets);

  let statusText = `Balance: $${balance} | Tickets: ${tickets}`;
  if (countdownSeconds !== null) {
    statusText += ` | Ripping Ticket...`;
  }
  statusEl.innerText = statusText;
  balanceDisplay.innerText = statusText;
}


function showPopup(text, duration = 2500) {
  popup.innerText = text;
  popup.style.display = 'block';
  setTimeout(() => {
    popup.style.display = 'none';
  }, duration);
}

function generateUniqueNumbers(count) {
  const nums = [];
  while (nums.length < count) {
    const n = Math.floor(Math.random() * 99) + 1;
    if (!nums.includes(n)) nums.push(n);
  }
  return nums;
}

function generateScratchNumbers() {
  const result = [];
  while (result.length < 15) {
    const chance = Math.random();
    if (chance < 0.01) result.push("100x");
    else if (chance < 0.03) result.push("10x");
    else if (chance < 0.06) result.push("5x");
    else if (chance < 0.1) result.push("2x");
    else if (chance < 0.12) result.push("Free Ticket");
    else result.push(Math.floor(Math.random() * 99) + 1);
  }
  return result;
}

function createScratchSlot(value, isWinning = false, revealed = true) {
  const slot = document.createElement('div');
  slot.className = 'scratch-slot';

  const text = document.createElement('div');
  text.className = 'scratch-content';
  text.innerText = revealed ? value : '?';

  const canvas = document.createElement('canvas');
  canvas.width = 300;
  canvas.height = 300;
  canvas.style.width = '100%';
  canvas.style.height = '100%';

  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#999';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

canvas.addEventListener('click', () => {
  if (!gameStarted || ctx.globalAlpha === 0) return;

  text.innerText = value;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.globalAlpha = 0;

  if (!isWinning) {
    if (bonuses.includes(value)) {
      bonus = value;
    }
    if (playerNumbers.includes(value)) {
      matches++;
    }
    if (freeTicketActive && value === "Free Ticket") {
      tickets++;
      updateDisplay();
      showPopup('ğŸŸï¸ You got a Free Ticket!', 1500);
    }
  }
  checkIfAllScratched();
});

  slot.appendChild(text);
  slot.appendChild(canvas);
  return slot;
}

function checkIfAllScratched() {
  const canvases = document.querySelectorAll('#scratch-grid canvas');
  const allCleared = Array.from(canvases).every(c => c.getContext('2d').globalAlpha === 0);
  if (allCleared) endGame();
}

function endGame() {
  clearInterval(countdownInterval);

  let win = 0;
  let base = matches === 1 ? 1 : matches === 2 ? 2 : matches === 3 ? 3 : 0;
  let multi = (bonus && bonus.endsWith('x')) ? parseInt(bonus) : 1;

  if (!freeTicketActive) {
    tickets = Math.max(0, tickets - 1);
    win = base * multi;
    if (bonus === "Free Ticket") tickets++;
  } else {
    if (bonus === "Free Ticket") tickets++;
  }
  if (!freeTicketActive && win > 0) balance += win;

  let resultText = '';
  if (win > 0) resultText += `ğŸ’° You matched ${matches} for $${win}`;
  else if (bonus === "Free Ticket") resultText += 'ğŸŸï¸ You won a Free Ticket!';
  else resultText = 'ğŸ˜¢ No matches';

  if (bonus && bonus !== "Free Ticket") resultText += ` + Bonus ${bonus}`;

  resultDiv.innerText = resultText;
  updateDisplay();

  gameStarted = false;
  disableButtons(true);

  let countdown = 5;
  updateDisplay(countdown);
  countdownInterval = setInterval(() => {
    countdown--;
    if (countdown > 0) {
      updateDisplay(countdown);  // show "Ripping Ticket..."
    } else {
      clearInterval(countdownInterval);
      updateDisplay(); // no countdown, just balance and tickets
      disableButtons(false);
      showEmptyGrid();
      updateButtonStates();
    }
  }, 1000);
}


function disableButtons(disable) {
  buyBtn.disabled = disable || balance < 5 || gameStarted;
  freeBtn.disabled = disable || gameStarted;
}

function updateButtonStates() {
  buyBtn.disabled = balance < 5 || gameStarted;
  freeBtn.disabled = gameStarted;
}

function buildBoard() {
  playerNumbers = generateUniqueNumbers(3);
  scratchNumbers = generateScratchNumbers();
  matches = 0;
  bonus = null;
  resultDiv.innerText = '';

  const yourNumbersDiv = document.getElementById('your-numbers');
  const scratchGrid = document.getElementById('scratch-grid');
  yourNumbersDiv.innerHTML = '';
  scratchGrid.innerHTML = '';

  playerNumbers.forEach(num => {
    yourNumbersDiv.appendChild(createScratchSlot(num, true, true));
  });
  scratchNumbers.forEach(val => {
    scratchGrid.appendChild(createScratchSlot(val, false, true));
  });

  yourNumbersDiv.classList.remove('disabled-grid');
  scratchGrid.classList.remove('disabled-grid');

  gameStarted = true;
  updateButtonStates();
}

function showEmptyGrid() {
  const yourNumbersDiv = document.getElementById('your-numbers');
  const scratchGrid = document.getElementById('scratch-grid');
  yourNumbersDiv.innerHTML = '';
  scratchGrid.innerHTML = '';

  const placeholderNumbers = generateUniqueNumbers(3);
  const placeholderScratch = generateScratchNumbers();

  placeholderNumbers.forEach(num => {
    yourNumbersDiv.appendChild(createScratchSlot(num, true, false));
  });
  placeholderScratch.forEach(val => {
    scratchGrid.appendChild(createScratchSlot(val, false, false));
  });

  yourNumbersDiv.classList.add('disabled-grid');
  scratchGrid.classList.add('disabled-grid');
}

buyBtn.addEventListener('click', () => {
  if (balance >= 5) {
    balance -= 5;
    tickets++;
    updateDisplay();
    updateButtonStates();
    freeTicketActive = false;
    buildBoard();
  } else {
    showPopup('âŒ Not enough funds to buy ticket ($5 required).');
  }
});

freeBtn.addEventListener('click', () => {
  freeTicketActive = true;
  showPopup('Begin Scratching', 2500);
  disableButtons(true);
  setTimeout(() => {
    buildBoard();
    disableButtons(false);
  }, 2500);
});

updateDisplay();
showEmptyGrid();
updateButtonStates();
</script>
<script>
  // Make sure cash is initialized
  if (!sessionStorage.getItem('playerCash')) {
    sessionStorage.setItem('playerCash', 100);
  }

  // Example: update your stats display
  function updateCashDisplay() {
    const cash = sessionStorage.getItem('playerCash');
    document.getElementById('cash-display').textContent = `$${cash}`;
  }

  // Call update on page load
  window.onload = updateCashDisplay;
</script>

</body>
</html>
